# 문서 품질

지난 편에서 문서화의 중요성을 강조했으니 이제 실제로 프로젝트 안에서 문서화 환경이 개발 초기부터 필요한 이유를 짧게 짚고 넘어가자.
문서화 환경은 단순히 문서를 만드는 것을 넘어서, 코드와 함께 진화하는 지식 저장소 역할을 한다.
초기부터 체계적인 문서화 환경을 갖추면 개발자들이 변경사항을 쉽게 공유하고, 프로젝트 전반의 이해도를 높이며, 유지보수를 원활하게 할 수 있다.

> 목표
>
> - 문서를 따로 떼어내지 않고 모노레포 안에서 관리
> - npm run docs:dev만 치면 문서 사이트 확인 가능
> - GitHub Pages로 자동 배포

## 왜 docs를 별도 패키지로 만들지 않고 루트에서 관리할까?

보통 모노레포에서는 각 기능별로 패키지를 나누지만, 문서화는 프로젝트의 일부이면서도 독립적으로 관리되어야 한다.
따라서 docs를 완전한 패키지로 만들기보다는 루트에서 별도의 워크스페이스로 관리하지 않고, 독립된 폴더로 두는 방식을 추천한다.
이렇게 하면 문서 빌드/배포가 패키지 의존성과 뒤섞이지 않고, 관리가 훨씬 깔끔해진다.
또한 docs를 워크스페이스에서 제외하면 의존성 충돌을 피할 수 있고, 설치 및 빌드 속도가 빨라지는 장점도 있다.

### 디렉토리 구조 제안

```text
/ (repo root)
├─ packages/
│  ├─ core/
│  └─ ... (추가 예정)
├─ docs/                # ← 문서 사이트(별도 패키지 아님, 루트의 워크스페이스로 관리 X)
│  ├─ src/
│  │  ├─ content/
│  │  │  ├─ en /
│  │  │  │  ├─ guides/    # How-to, 튜토리얼
│  │  │  │  ├─ concepts/  # 철학/디자인 개념
│  │  │  │  ├─ reference/ # API 레퍼런스(초안)
│  │  │  │  └─ blog/      # 연재글
│  │  │  └─ ko /
│  │  │     ├─ guides/
│  │  │     ├─ concepts/
│  │  │     ├─ reference/
│  │  │     └─ blog/
│  │  └─ components/   # MDX에서 쓰는 경고/팁/코드탭
│  ├─ public/
│  ├─ astro.config.mjs
│  ├─ tsconfig.json
│  ├─ package.json     # (optional: docs만 따로 둘 수도, 루트에 통합도 가능)
│  └─ README.md
├─ .github/
│  └─ workflows/
│     └─ docs.yml      # GitHub Pages 자동 배포
├─ .remarkrc.mjs       # Markdown 규칙(링크 깨짐 등 방지)
├─ .prettierrc
├─ .markdownlint.json
├─ package.json
└─ README.md
```

## 문서 품질관리 도구

코드만큼이나 문서 역시 **일관성**과 **정확성**이 중요하다. 문서 스타일이 제각각이면 프로젝트를 진행하는 과정에서 읽기가 어려워지고, 잘못된 링크나 깨진
메타데이터는 사용자 경험을 크게 저해한다. 이런 문제를 방지하려면 문서도 코드와 동일하게 품질 관리 대상에 포함시켜야 한다.

이를 위해 **Prettier**를 사용해 문서를 자동으로 포맷팅하고, **markdownlint**와 **remark**로 문법과 규칙을 검증하는 방식을 적용한다. 이렇게 하면
프로젝트 전반에서 문서 스타일을 일관되게 유지할 수 있고, 잘못된 링크나 형식 오류도 CI/CD 단계에서 자동으로 걸러내어 안정적인 문서 품질을 보장할 수 있다.

### 설치

```bash
# 루트에서 실행
npm install -D markdownlint-cli remark remark-cli remark-frontmatter remark-gfm remark-validate-links
```

### 각 도구 설명

- **markdownlint-cli:** Markdown 문서의 문법 오류나 스타일 위반을 잡아주는 CLI. 예: 제목 앞뒤 공백, 리스트 들여쓰기, 한 줄 길이 제한 같은 기본 규칙 체크.
- **remark:** Markdown을 파싱하고 검사/변환하는 엔진. 플러그인 시스템을 통해 문서 품질 검사를 유연하게 확장할 수 있음.
- **remark-frontmatter:** 문서 상단의 `---` 블록(frontmatter)을 인식하게 해주는 플러그인. 제목, 요약, 태그 같은 메타데이터를 안전하게 처리.
- **remark-gfm:** GitHub Flavored Markdown 지원. 체크박스 리스트(`- [ ]`), 테이블(`|---|`) 같은 GFM 확장 문법을 사용할 수 있음.
- **remark-validate-links:** 문서 내 링크가 깨져 있는지 검사. 내부 경로나 GitHub 저장소 내 문서 링크가 유효한지 CI에서 자동 확인 가능.

---

### package.json 스크립트 추가

`package.json`에 문서 품질 관리 스크립트를 추가합니다:

```json
{
  "name": "lynjs",
  "scripts": {
    "docs:check": "remark docs/src --quiet --frail && markdownlint \"docs/**/*.{md,mdx}\"",
    "docs:fix": "prettier -w \"docs/**/*.{md,mdx,json,ts,tsx,astro}\""
  }
}
```

- **docs:check:** 문서를 검사하는 명령.
  - `remark docs/src --quiet --frail`: remark를 통해 문서 문법, frontmatter, 링크 유효성을 점검.
  - `markdownlint "docs/**/*.{md,mdx}"`: MarkdownLint로 스타일 규칙 위반 여부 확인.
    > CI/CD에서 사용하면 문서 품질 문제를 자동으로 감지할 수 있음.

- **docs:fix:** 문서를 자동으로 고치는 명령.
  - `prettier -w`: Prettier로 Markdown/MDX 문서를 일괄 포맷팅.
    > 개발자가 직접 일일이 수정하지 않아도 기본 스타일을 자동 적용할 수 있음.

## 문서 전용 ignore 파일들

문서 품질 검사를 할 때는 **실제로 관리해야 하는 문서만 검사**하는 게 중요하다.
외부 라이브러리의 README나 빌드 산출물까지 검사하면 불필요한 에러가 발생할 수 있기 때문이다.
그래서 `markdownlint`와 `remark` 전용 ignore 파일을 두고, 검사 대상에서 제외할 디렉터리를 명시한다.

#### .markdownlintignore

```ignore
node_modules
**/node_modules/**
dist
```

- `node_modules`: 외부 의존성의 문서 파일 제외
- `**/node_modules/**`: 혹시 docs 하위에 설치된 node_modules까지도 확실히 제외
- `dist`: 빌드 결과물에서 생성되는 문서 파일 제외

#### .remarkignore

```ignore
node_modules
**/node_modules/**
dist
```

- 의미는 위와 동일하지만, `remark` 실행 시 적용된다.
- 두 파일을 분리해두면 lint 도구별로 예외 규칙을 개별적으로 관리할 수 있다.

## lint-staged 규칙 추가

lint-staged는 **커밋 시점에 staged된 파일만 빠르게 검사/포맷**하기 위해 사용된다.
아래 설정은 문서와 코드, 기타 설정 파일을 각각 적절한 **`npm run` 스크립트**를 통해 처리하도록 구성한 예시이다.

```json
{
  "lint-staged": {
    "docs/**/*.{md,mdx}": ["npm run docs:fix", "npm run docs:check"],

    "*.{md,mdx}": ["prettier -w"],

    "*.{ts,tsx,js,cjs,mjs}": ["npm run lint:fix"],

    "*.{json,yml,yaml,css,scss,html}": ["prettier -w"]
  }
}
```

---

### 각 항목 설명

- **`docs/**/\*.{md,mdx}`\*\*
  - `docs` 디렉터리 안의 모든 Markdown/MDX 문서에 적용
  - `npm run docs:fix`: Prettier 기반 문서 포맷 자동 정리
  - `npm run docs:check`: remark + markdownlint로 문법/스타일/링크 규칙 검증
    👉 두 단계를 같이 실행해 “자동 정리 + 규칙 검증”을 한 번에 처리

- **`*.{md,mdx}`**
  - 루트나 패키지 폴더 안에 있는 일반 문서 (예: 프로젝트 README.md)도 Prettier로만 정리
  - 규칙 검증은 생략 → 외부 라이브러리 README까지 검사하는 불필요한 노이즈 방지

- **`*.{ts,tsx,js,cjs,mjs}`**
  - 코드 파일에 대해 `npm run lint:fix` 실행
  - 내부적으로 `eslint --fix --max-warnings=0` 동작 → 자동 고침 + 경고까지 차단

- **`*.{json,yml,yaml,css,scss,html}`**
  - 설정 파일, 스타일 파일을 Prettier로 자동 정리
  - 들여쓰기, 따옴표, 줄바꿈 등 포맷을 일관되게 유지

이렇게 구성하면 커밋 직전에 문서와 코드가 자동으로 포맷되고, 필요한 규칙 검사가 함께 실행된다.
덕분에 개발자가 따로 신경 쓰지 않아도 프로젝트 전반의 문서와 코드가 항상 일관된 품질을 유지한다.
또한 검사 대상을 실제 관리해야 하는 파일로 한정했기 때문에, 외부 라이브러리의 README나 빌드 산출물에서 발생하는 불필요한 잡음도 줄어든다.
