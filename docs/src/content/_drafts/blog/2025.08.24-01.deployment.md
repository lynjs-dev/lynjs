# Git과 NPM 배포

모노레포 뼈대와 타입스크립트 설정까지 준비했으니, 이제 이 프로젝트를 버전 관리하고 GitHub에 올려 협업과 배포의 기반을 만들어야 한다.

프레임워크나 라이브러리를 처음 만들 때 흔히 “코드부터 작성해도 되지 않을까?”라는 생각이 들지만, 실제로는 **처음부터 저장소와 배포 경로를 마련해 두는 것**이 훨씬 안정적이다.

- **협업 기반 확보**
  Git으로 이력을 남기고 GitHub 같은 원격 저장소에 올려야 다른 사람과 함께 작업할 수 있다. 코드 리뷰, 이슈 관리, 브랜치 전략 같은 협업 도구는 프로젝트 초반부터 정착시켜야 나중에 혼란이 없다.

- **배포 채널 선점**
  npm에 패키지를 일찍 올려두면, 프로젝트 이름(`lynjs`)을 먼저 확보할 수 있다. 실제 API가 준비되지 않았더라도, “여기서 공식적으로 관리한다”는 시그널을 줄 수 있고 다른 사람이 같은 이름을 차지하는 걸 방지할 수 있다.

- **투명한 개발 과정 공유**
  초기 상태를 GitHub와 npm에 배포해두면, 외부 기여자나 관심 있는 개발자가 “지금 어느 단계까지 와 있는지”를 쉽게 파악할 수 있다.

즉, 이번 단계는 단순히 코드를 업로드하는 작업이 아니라, **협업·배포·브랜딩을 동시에 준비하는 출발점**이라고 할 수 있다.

## 목표

이번 글의 최종 목표는 **“처음부터 협업·배포가 끊기지 않는 상태”**를 만드는 것이다.
코드는 아직 비어 있어도, **저장소/브랜치/배포 채널**은 바로 쓸 수 있게 깔끔히 준비한다.

### 우리가 달성할 것

- **Git 저장소 초기화 & 기본 브랜치 정비:** `main` 기준으로 통일
- **불필요 파일 차단:** `.gitignore`로 빌드/캐시/로그를 기본 차단
- **원격 연결 & 첫 푸시:** SSH 키 기반으로 GitHub에 `lynjs` 저장소 연결
- **안전한 npm 스켈레톤 배포:** 문서만 포함된 패키지(`README.md`, `LICENSE`)를 **프리릴리스 채널(`next`)**로 퍼블리시
- **배포 전 검증 루틴:** `npm pack --dry-run`으로 tarball 오염 방지
- **최소 스크립트 자동화:** `prepublishOnly → verify:pack` 훅으로 실수 방지
- **향후 확장 포인트 명시:** 공개 API 오픈 시 `exports/types/files` 여는 절차를 체크리스트로 고정

### 완료 기준

- GitHub에 `lynjs` 저장소가 존재하고, `main` 브랜치로 최초 커밋/푸시 완료
- 저장소 **Branch Protection** 설정(Force push 금지, 리뷰/체크 필수 등) 적용
- `npm info lynjs@next`에서 배포 기록 확인 가능
- `npm pack --dry-run` 출력에 **문서 2종(README, LICENSE)**만 포함
- `package.json`에 다음이 포함됨
  - `"exports": {}` (임포트 차단)
  - `"files": ["README.md", "LICENSE"]`
  - `"scripts": { "verify:pack", "prepublishOnly" }`
  - `"publishConfig": { "access": "public" }`

### 검증 체크리스트

- [ ] `git branch -M main` 이후 모든 작업이 `main` 기준으로 이뤄지는가?
- [ ] `.gitignore`가 빌드/캐시/로그/테스트 산출물까지 충분히 커버하는가?
- [ ] `ssh -T git@github.com` 으로 SSH 연결이 정상 동작하는가?
- [ ] `npm pack --dry-run` 결과에 예상치 못한 파일이 없나?
- [ ] `npm publish --tag next` 후 `npm info lynjs@next`로 조회되는가?

### 범위 밖

- 공개 API/타입 방출(`types/`, 번들) 본격 도입
- 다중 패키지(monorepo packages/\*) 개별 배포
- semantic-release/Changesets 기반의 완전 자동 배포(다음 글에서)

### 리스크 & 가드레일

- **패키지 이름 선점 실패:** `lynjs`가 이미 점유되어 있으면, 이름 또는 스코프(@org/lynjs) 전략으로 우회
- **tarball 오염:** 항상 `prepublishOnly → verify:pack` 훅으로 차단
- **채널 혼선:** 초기엔 반드시 `--tag next`만 사용, 공개 API 후 `latest` 전환

> 요약: 지금 단계의 목표는 “빈 패키지라도 안전하게 배포되고, 협업·배포 루틴이 이미 굴러가는 상태”를 만드는 것. 이후 기능을 얹어도 파이프라인은 그대로 유지된다.

## Git 초기 설정

### Git 저장소 초기화

```bash
git init
```

`.git/` 폴더가 생기면 이제 모든 변경 이력은 Git으로 관리된다.

### 기본 브랜치 이름 변경

Git은 기본적으로 `master` 브랜치를 만든다. 이를 `main`으로 바꾼다.

```bash
git branch -M main
```

### .gitignore 작성

`node_modules/`, `dist/`, 로그 파일 같은 불필요한 것들은 자동으로 무시하기 위해 `.gitignore`를 작성한다.

**.gitignore**

```gitignore
# Node modules
node_modules/

# Build output
dist/
build/
out/

# TypeScript cache
*.tsbuildinfo

# Logs
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*
lerna-debug.log*

# Environment variables
.env
.env.*.local

# Editor directories and files
.vscode/
.idea/
*.swp

# OS specific
.DS_Store
Thumbs.db

# Test coverage
coverage/
.nyc_output/

# Temporary files
tmp/
*.tmp
*.temp
*.log
*.bak

# Package manager specific
.pnpm-debug.log*
# package-lock.json
# yarn.lock
# pnpm-lock.yaml

# Vitest / Jest cache
.vitest/
.jest/

#ESLint cache
.eslintcache

# Misc
.cache/
.parcel-cache/

# Only ignore npm pack tarballs
lynjs-*.tgz
```

### 첫 커밋

```bash
git add .
git commit -m "chore: initialize LynJS monorepo structure"
```

이렇게 하면 뼈대 상태 그대로 첫 이력이 남는다.

## GitHub 저장소 연결

### GitHub에서 새 저장소 만들기

GitHub 웹에서 `lynjs`라는 새 repository를 생성한다.

- Repository name: `lynjs`
- Public / Private 여부는 필요에 맞게 선택
- README, `.gitignore`, license는 체크하지 않는다 (이미 로컬에 있으므로).

### 원격 저장소 등록

생성된 저장소 주소를 복사한다. (예: `git@github.com:lynjs-dev/lynjs.git`)
로컬 프로젝트에서 원격을 등록한다.

```bash
git remote add origin git@github.com:lynjs-dev/lynjs.git
```

> GitHub를 사용하기 위해서는 SSH를 사용해야 한다.
>
> **SSH 키 생성**
>
> ```bash
> ssh-keygen -t ed25519 -C "your_email@example.com"
> ```
>
> - `-C` 옵션에는 GitHub 계정 이메일을 입력한다.
> - 경로 입력을 묻는 메시지가 나오면 경로를 입력한다. (기본값: `~/.ssh/id_ed25519`).
> - 암호(passphrase)는 선택 사항이지만 보안을 위해 입력하는 것이 좋다.
>
> **ssh-agent 실행 및 키 추가 (리눅스/맥)**
>
> ```bash
> eval "$(ssh-agent -s)"
> ssh-add ~/.ssh/id_ed25519
> ```
>
> **공개 키 복사 및 등록**
>
> ```bash
> cat ~/.ssh/id_ed25519.pub
> ```
>
> 출력된 문자열(`ssh-ed25519 AAAA...`)을 복사하여 GitHub에 등록한다.
>
> - https://github.com/settings/keys

### GitHub에 푸시

```bash
git push -u origin main
```

### 배포 이후 확인할 것

- GitHub 저장소의 Settings → Branches에서 `main` 브랜치를 **보호 규칙(protection rule)**으로 설정해두면 안전하다.
  (force push 금지, 리뷰 필수 등)
- Issue, Project, Wiki 같은 GitHub 기능을 사용해서 LynJS 개발 과정을 투명하게 관리할 수도 있다.
- 앞으로 npm 배포 자동화를 연결하려면 GitHub Actions를 활용할 수 있는데, 이는 차후에 별도로 다룰 예정이다.

## npm 배포 준비

### 루트에 배포 필수 파일 만들기

우선 `package.json`, `README.md`, `LICENSE` 세 개만으로도 배포가 가능하다.
사용자에게는 “아직 API 없음(WIP)”임을 명확히 알리고, 가져가면 안 된다는 시그널을 주자.

**package.json**

```json
{
  "name": "lynjs",
  "version": "0.0.1",
  "private": false,
  "type": "module",

  "repository": {
    "type": "git",
    "url": "https://github.com/[GITHUB_USER_NAME]/[REPOSITORY_NAME]"
  },

  "exports": {},

  "files": ["README.md", "LICENSE"],

  "sideEffects": false,

  "scripts": {
    "build": "echo \"(root) nothing to build yet\"",
    "clean": "git clean -fdX -e node_modules",
    "test": "echo \"(root) no tests yet\" && exit 0",

    "verify:pack": "npm pack --dry-run",
    "prepublishOnly": "npm run verify:pack"
  },

  "engines": {
    "node": ">=18"
  },

  "publishConfig": {
    "access": "public"
  }
}
```

- `exports: {}` 로 임포트 차단 → 지금 시점에 `import 'lynjs'`를 시도하면 에러 발생.
- `files`에 문서만 포함 → JS/타입 아티팩트가 없으므로 문서만 배포.
- 추후 API 공개 시 `exports`를 열고, 공개 엔트리와 타입 경로 추가.
- **verify:pack:** 배포 전, tarball에 포함될 파일을 미리 검증하여 오염된 배포를 방지
- **prepublishOnly:** npm publish/npm pack 직전에 verify:pack을 강제 실행하여 검증 실패 시 배포 차단

**README.md**

```markdown
**⚠️ 현재는 API가 공개되지 않았습니다.**
이 패키지는 모노레포의 루트로서 배포 채널과 이름을 선점하기 위한 **초기 골격**입니다.

- JS 변환/번들링: 하지 않음
- JS 파일: 현재 없음 (향후 단계에서 공개 API 제공 예정)
- TypeScript: 타입 설정 작업 진행 중

향후 버전에서 다음이 추가됩니다:

- 공개 API (`import { LynElement } from 'lynjs'`)
- 선언 파일(types) 및 문서
```

**LICENSE**

```text
BSD 3-Clause License

Copyright (c) 2025 MoGi. All rights reserved.

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are met:

1. Redistributions of source code must retain the above copyright notice, this
   list of conditions and the following disclaimer.

2. Redistributions in binary form must reproduce the above copyright notice,
   this list of conditions and the following disclaimer in the documentation
   and/or other materials provided with the distribution.

3. Neither the name of the copyright holder nor the names of its
   contributors may be used to endorse or promote products derived from
   this software without specific prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
```

> 추가 수정된 파일을 커밋한다.
>
> ```bash
> git add .
> git commit -m "chore(npm): prepare initial publish skeleton"
> ```

## 배포 전 점검

버전 tag 초기화

```
git tag v0.0.1
git push origin v0.0.1
```

항상 배포 전에 포장물(tarball)에 들어갈 파일 목록을 확인한다.

```bash
npm run verify:pack
# 또는
npm pack --dry-run
```

목록에 `README.md`, `LICENSE`만 포함되는지 확인한다.
실제 tarball도 열어보려면:

```bash
npm pack                      # lynjs-0.0.1.tgz 생성
tar -tzf lynjs-0.0.1.tgz
```

## 버전 및 태그 전략

아직 API가 없으므로 **프리릴리스 태그(next)**로 배포하는 것을 권장한다.
이렇게 하면 기본 설치 채널(latest)을 오염시키지 않는다.

```bash
# npm 로그인
npm adduser

# 프리릴리스 버전 지정
npm version prerelease --preid=next    # 0.0.2-next.0 같은 형태
git push --follow-tags

# 배포
npm publish --tag next
```

배포 확인:

```bash
npm info lynjs
npm info lynjs@next
```

또는 npm 웹사이트에서 확인:
https://www.npmjs.com/package/lynjs

채널 가이드:

- **next:** 개발자 미리보기 (npm i lynjs@next)
- **latest:** 안정 릴리스(추후 API 공개 후 전환)
- **canary:** 실험 채널

## 공개 API 준비

공개 API를 여는 순간 해야 할 일:

- `exports`를 열고 진입점 지정

```json
{
  "exports": {
    ".": {
      "types": "./types/index.d.ts",
      "import": "./index.js"
    }
  },
  "types": "./types/index.d.ts"
}
```

- `files` 항목에 실제 공개 파일 추가 (`index.js`, `types/**`, `README.md`, `LICENSE`)
- `tsc --emitDeclarationOnly` 파이프라인으로 `types/` 자동 생성
- 내부 워크스페이스(`packages/*`)의 공개 표면을 루트에서 re-export → 단일 `lynjs` 경험 제공

## 정리

- 지금은 문서만 있는 빈 패키지를 안전하게 배포한다.
- `exports: {}` 로 임포트를 막아 사용자 혼선을 방지한다.
- 채널은 `next`를 써서 공식 릴리스와 분리한다.
- 다음 단계에서 공개 API와 타입 방출을 열면서 `latest`로 승격한다.
