# Commit 메시지 규칙

## 기본 포맷

```
<type>(<scope>): <subject>
<BLANK LINE>
<body>        # 선택
<BLANK LINE>
BREAKING CHANGE: <details>  # 선택
<BLANK LINE>
Refs: <issues/links>        # 선택
```

- `<type>`: **소문자**, 정해진 목록 중 하나 사용
- `<scope>`: **선택** (모듈/폴더/영역명), 여러 단어는 케밥(`linting-rules`)
- `<subject>`: **명령형 현재형**, 마침표 금지 (한글/영문 모두 가능)
- 본문/푸터: **72자 내 줄바꿈 권장**

## Type 규칙

| type         | 의미                | 릴리스 영향    |
| ------------ | ------------------- | -------------- |
| **feat**     | 기능 추가           | **minor**      |
| **fix**      | 버그 수정           | **patch**      |
| **perf**     | 성능 개선           | patch(보통)    |
| **refactor** | 리팩터링(동작 동일) | 없음           |
| **docs**     | 문서 변경           | 없음 _(예외↓)_ |
| **chore**    | 빌드/도구/설정      | 없음 _(예외↓)_ |
| **test**     | 테스트 추가/수정    | 없음           |
| **revert**   | 변경 되돌리기       | 해당 변경 반영 |

> **예외 규칙(우리 설정)**
> `docs(release): ...`, `chore(release): ...` → **patch 릴리스**

## Scope 규칙

- 선택적이지만, 모듈/영역 명시 시 가독성 ↑
- 여러 단어는 **kebab-case**
- 추천 스코프:
  - **코어/런타임**: `core`, `api`, `types`
  - **도구/빌드**: `build`, `tooling`, `config`, `deps`
  - **프로세스/배포**: `release`, `ci`
  - **품질/문서**: `test`, `docs`
- 모노레포의 경우 `packages/*` 디렉토리명을 그대로 scope로 활용 가능

## Subject & Body 스타일

- **Subject**: **명령형 현재형** (“Add”, “Fix”, “Update”)
- **금지**: 마침표(`.`), 대문자 type(`Fix:`), 불필요한 이모지(🔥, 🚀 등)
- **Body (선택)**: 배경, 의도, 제약, 대안 설명 — 72자 내 줄바꿈 권장
- **Footer (선택)**: `Refs:`, `Closes #123` 등 이슈/PR 연결

### 샘플

**간단한 메시지 (본문 없음)**

```
fix(api): handle empty input gracefully
```

**본문 포함 메시지**

```
feat(core): add plugin system

Introduce a plugin registration API that allows external
packages to extend core functionality. This is the first
step towards a modular architecture.

Refs: #42
```

## Breaking Change

- 메이저 변경은 **느낌표** 또는 **본문 푸터**로 명시
  - `feat!: drop deprecated API`
  - 본문 끝에 `BREAKING CHANGE: ...` 구체적으로 작성
    → 무엇이 깨지는지, 왜 필요한지, 마이그레이션 방법

## 좋은/나쁜 예시

**좋은 예**

```
feat(core): add plugin system

fix(cli): handle empty args without throwing

docs(release): document semantic-release flow
```

**BREAKING 예**

```
feat!: remove deprecated init command

BREAKING CHANGE: The `init` command has been removed.
Use `create` instead. See MIGRATION.md for details.
```

**릴리스 유도용(패치)**

```
chore(release): enable npm publish in CI
```

**나쁜 예**

```
update code                # type 없음
feat: add X.               # 마침표
Fix: Something             # 대문자 type
docs: .................... # 본문 없이 장문 subject
```

## commitlint 설정

**`commitlint.config.cjs`**

```js
const scopes = ['core', 'api', 'types', 'build', 'tooling', 'config', 'deps', 'release', 'ci', 'test', 'docs'];

module.exports = {
  extends: ['@commitlint/config-conventional'],
  rules: {
    'type-case': [2, 'always', 'lower-case'],
    'scope-case': [2, 'always', 'kebab-case'],
    'subject-full-stop': [2, 'never', '.'],
    'header-max-length': [2, 'always', 100],
    'scope-enum': [2, 'always', scopes],
    'scope-empty': [0, 'never'], // 선택적으로 허용
  },
};
```

**Husky(v10)**
`.husky/commit-msg`

```sh
[ -n "$CI" ] && exit 0
npx --no-install commitlint --edit "$1"
```

## 릴리스 전 체크리스트

- Dry-run: `npx semantic-release --dry-run`
- PR 리뷰 시 **릴리스 타입(feat/minor, fix/patch)** 확인
- 애매한 경우 → `docs:` / `chore:` 사용 (릴리스 영향 없음)
